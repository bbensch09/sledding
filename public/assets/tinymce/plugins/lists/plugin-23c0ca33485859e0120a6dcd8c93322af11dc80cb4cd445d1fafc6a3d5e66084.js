/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.5.1 (2020-10-01)
 */
!function(){"use strict";var e,n,t,r,o,i,u,a=tinymce.util.Tools.resolve("tinymce.PluginManager"),s=function(){},c=function(e){return function(){return e}},f=function(e){return function(n){return!e(n)}},d=c(!1),l=c(!0),m=function(){return p},p=(e=function(e){return e.isNone()},{fold:function(e){return e()},is:d,isSome:d,isNone:l,getOr:t=function(e){return e},getOrThunk:n=function(e){return e()},getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(undefined),or:t,orThunk:n,map:m,each:s,bind:m,exists:d,forall:l,filter:m,equals:e,equals_:e,toArray:function(){return[]},toString:c("none()")}),g=function(e){var n=c(e),t=function(){return o},r=function(n){return n(e)},o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:l,isNone:d,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:t,orThunk:t,map:function(n){return g(n(e))},each:function(n){n(e)},bind:r,exists:r,forall:r,filter:function(n){return n(e)?o:p},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(d,function(n){return t(e,n)})}};return o},v={some:g,none:m,from:function(e){return null===e||e===undefined?p:g(e)}},h=function(e){return function(n){return r=typeof(t=n),(null===t?"null":"object"==r&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==r&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":r)===e;var t,r}},y=function(e){return function(n){return typeof n===e}},S=h("string"),b=h("array"),C=y("boolean"),O=y("function"),N=y("number"),L=Array.prototype.slice,T=Array.prototype.push,D=function(e,n){for(var t=e.length,r=new Array(t),o=0;o<t;o++){var i=e[o];r[o]=n(i,o)}return r},k=function(e,n){for(var t=0,r=e.length;t<r;t++)n(e[t],t)},w=function(e,n){for(var t=[],r=0,o=e.length;r<o;r++){var i=e[r];n(i,r)&&t.push(i)}return t},x=function(e,n,t){return k(e,function(e){t=n(t,e)}),t},A=function(e,n,t){for(var r=0,o=e.length;r<o;r++){var i=e[r];if(n(i,r))return v.some(i);if(t(i,r))break}return v.none()},E=function(e,n){return A(e,n,d)},P=function(e,n){return function(e){for(var n=[],t=0,r=e.length;t<r;++t){if(!b(e[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+e);T.apply(n,e[t])}return n}(D(e,n))},B=function(e){var n=L.call(e,0);return n.reverse(),n},I=function(e){return 0===e.length?v.none():v.some(e[0])},R=function(e){return 0===e.length?v.none():v.some(e[e.length-1])},M=function(){return(M=Object.assign||function(e){for(var n,t=1,r=arguments.length;t<r;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},U=function(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}return undefined}(e,n);if(!t)return{major:0,minor:0};var r=function(e){return Number(n.replace(t,"$"+e))};return F(r(1),r(2))},_=function(){return F(0,0)},F=function(e,n){return{major:e,minor:n}},H={nu:F,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?_():U(e,t)},unknown:_},$=function(e,n){var t=String(n).toLowerCase();return E(e,function(e){return e.search(t)})},j=function(e,n){return $(e,n).map(function(e){var t=H.detect(e.versionRegexes,n);return{current:e.name,version:t}})},q=function(e,n){return $(e,n).map(function(e){var t=H.detect(e.versionRegexes,n);return{current:e.name,version:t}})},K=function(e,n){return-1!==e.indexOf(n)},V=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,W=function(e){return function(n){return K(n,e)}},Q=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return K(e,"edge/")&&K(e,"chrome")&&K(e,"safari")&&K(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,V],search:function(e){return K(e,"chrome")&&!K(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return K(e,"msie")||K(e,"trident")}},{name:"Opera",versionRegexes:[V,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:W("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:W("firefox")},{name:"Safari",versionRegexes:[V,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(K(e,"safari")||K(e,"mobile/"))&&K(e,"applewebkit")}}],X=[{name:"Windows",search:W("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return K(e,"iphone")||K(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:W("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:W("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:W("linux"),versionRegexes:[]},{name:"Solaris",search:W("sunos"),versionRegexes:[]},{name:"FreeBSD",search:W("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:W("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],z={browsers:c(Q),oses:c(X)},Y="Edge",G="Chrome",J="Firefox",Z=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isEdge:r(Y),isChrome:r(G),isIE:r("IE"),isOpera:r("Opera"),isFirefox:r(J),isSafari:r("Safari")}},ee={unknown:function(){return Z({current:undefined,version:H.unknown()})},nu:Z,edge:c(Y),chrome:c(G),ie:c("IE"),opera:c("Opera"),firefox:c(J),safari:c("Safari")},ne="Windows",te="Android",re="Solaris",oe="FreeBSD",ie="ChromeOS",ue=function(e){var n=e.current,t=e.version,r=function(e){return function(){return n===e}};return{current:n,version:t,isWindows:r(ne),isiOS:r("iOS"),isAndroid:r(te),isOSX:r("OSX"),isLinux:r("Linux"),isSolaris:r(re),isFreeBSD:r(oe),isChromeOS:r(ie)}},ae={unknown:function(){return ue({current:undefined,version:H.unknown()})},nu:ue,windows:c(ne),ios:c("iOS"),android:c(te),linux:c("Linux"),osx:c("OSX"),solaris:c(re),freebsd:c(oe),chromeos:c(ie)},se=function(e,n){var t,r,o,i,u,a,s,f,d,l,m,p,g=z.browsers(),v=z.oses(),h=j(g,e).fold(ee.unknown,ee.nu),y=q(v,e).fold(ae.unknown,ae.nu);return{browser:h,os:y,deviceType:(r=h,o=e,i=n,u=(t=y).isiOS()&&!0===/ipad/i.test(o),a=t.isiOS()&&!u,s=t.isiOS()||t.isAndroid(),f=s||i("(pointer:coarse)"),d=u||!a&&s&&i("(min-device-width:768px)"),l=a||s&&!d,m=r.isSafari()&&t.isiOS()&&!1===/safari/i.test(o),p=!l&&!d&&!m,{isiPad:c(u),isiPhone:c(a),isTablet:c(d),isPhone:c(l),isTouch:c(f),isAndroid:t.isAndroid,isiOS:t.isiOS,isWebView:c(m),isDesktop:c(p)})}},ce=function(e){return window.matchMedia(e).matches},fe=(i=!(r=function(){return se(navigator.userAgent,ce)}),function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i||(i=!0,o=r.apply(null,e)),o}),de=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:e}},le={fromHtml:function(e,n){var t=(n||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return de(t.childNodes[0])},fromTag:function(e,n){var t=(n||document).createElement(e);return de(t)},fromText:function(e,n){var t=(n||document).createTextNode(e);return de(t)},fromDom:de,fromPoint:function(e,n,t){return v.from(e.dom.elementFromPoint(n,t)).map(de)}},me=function(e,n){return e.dom===n.dom},pe=function(e,n){return t=e.dom,r=n.dom,o=Node.DOCUMENT_POSITION_CONTAINED_BY,0!=(t.compareDocumentPosition(r)&o);var t,r,o},ge=function(e,n){return fe().browser.isIE()?pe(e,n):(t=n,(r=e.dom)!==(o=t.dom)&&r.contains(o));var t,r,o},ve=function(e,n){var t=e.dom;if(1!==t.nodeType)return!1;var r=t;if(r.matches!==undefined)return r.matches(n);if(r.msMatchesSelector!==undefined)return r.msMatchesSelector(n);if(r.webkitMatchesSelector!==undefined)return r.webkitMatchesSelector(n);if(r.mozMatchesSelector!==undefined)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")},he=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),ye=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),Se=tinymce.util.Tools.resolve("tinymce.util.VK"),be=Object.keys,Ce=function(e,n){for(var t=be(e),r=0,o=t.length;r<o;r++){var i=t[r];n(e[i],i)}},Oe=function(e,n){var t,r,o,i,u={};return t=n,i=u,r=function(e,n){i[n]=e},o=s,Ce(e,function(e,n){(t(e,n)?r:o)(e,n)}),u},Ne=("undefined"!=typeof window||Function("return this;")(),function(e){return e.dom.nodeName.toLowerCase()}),Le=(u=1,function(e){return e.dom.nodeType===u}),Te=function(e,n){var t=e.dom;Ce(n,function(e,n){!function(e,n,t){if(!(S(t)||C(t)||N(t)))throw console.error("Invalid call to Attribute.set. Key ",n,":: Value ",t,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(n,t+"")}(t,n,e)})},De=function(e){return x(e.dom.attributes,function(e,n){return e[n.name]=n.value,e},{})},ke=function(e){return v.from(e.dom.parentNode).map(le.fromDom)},we=function(e){return D(e.dom.childNodes,le.fromDom)},xe=function(e,n){var t=e.dom.childNodes;return v.from(t[n]).map(le.fromDom)},Ae=function(e){return xe(e,0)},Ee=function(e){return xe(e,e.dom.childNodes.length-1)},Pe=function(e,n){ke(e).each(function(t){t.dom.insertBefore(n.dom,e.dom)})},Be=function(e,n){e.dom.appendChild(n.dom)},Ie=function(e,n){k(n,function(n){Be(e,n)})},Re=function(e){var n=e.dom;null!==n.parentNode&&n.parentNode.removeChild(n)},Me=function(e){return n=e,t=!0,le.fromDom(n.dom.cloneNode(t));var n,t},Ue=function(e,n){var t,r,o,i,u=(t=e,r=n,o=le.fromTag(r),i=De(t),Te(o,i),o);Pe(e,u);var a=we(e);return Ie(u,a),Re(e),u},_e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Fe=tinymce.util.Tools.resolve("tinymce.util.Tools"),He=function(e){return function(n){return n&&n.nodeName.toLowerCase()===e}},$e=function(e){return function(n){return n&&e.test(n.nodeName)}},je=function(e){return e&&3===e.nodeType},qe=$e(/^(OL|UL|DL)$/),Ke=$e(/^(OL|UL)$/),Ve=He("ol"),We=$e(/^(LI|DT|DD)$/),Qe=$e(/^(DT|DD)$/),Xe=$e(/^(TH|TD)$/),ze=He("br"),Ye=function(e,n){return n&&!!e.schema.getTextBlockElements()[n.nodeName]},Ge=function(e,n){return e&&e.nodeName in n},Je=function(e,n,t){var r=e.isEmpty(n);return!(t&&0<e.select("span[data-mce-type=bookmark]",n).length)&&r},Ze=function(e,n){return e.isChildOf(n,e.getRoot())},en=function(e,n){var t,r,o,i,u=e.dom,a=e.schema.getBlockElements(),s=u.createFragment(),c=!1===(t=e.getParam("forced_root_block","p"))?"":!0===t?"p":t;if(c&&((o=u.create(c)).tagName===c.toUpperCase()&&u.setAttribs(o,e.getParam("forced_root_block_attrs",{})),Ge(n.firstChild,a)||s.appendChild(o)),n)for(;r=n.firstChild;){var f=r.nodeName;i||"SPAN"===f&&"bookmark"===r.getAttribute("data-mce-type")||(i=!0),Ge(r,a)?(s.appendChild(r),o=null):c?(o||(o=u.create(c),s.appendChild(o)),o.appendChild(r)):s.appendChild(r)}return c?i||o.appendChild(u.create("br",{"data-mce-bogus":"1"})):s.appendChild(u.create("br")),s},nn=_e.DOM,tn=function(e,n){ve(n,"dd")?Ue(n,"dt"):ve(n,"dt")&&ke(n).each(function(t){return function(e,n,t){var r=nn.select('span[data-mce-type="bookmark"]',n),o=en(e,t),i=nn.createRng();i.setStartAfter(t),i.setEndAfter(n);for(var u,a=i.extractContents(),s=a.firstChild;s;s=s.firstChild)if("LI"===s.nodeName&&e.dom.isEmpty(s)){nn.remove(s);break}e.dom.isEmpty(a)||nn.insertAfter(a,n),nn.insertAfter(o,n),Je(e.dom,t.parentNode)&&(u=t.parentNode,Fe.each(r,function(e){u.parentNode.insertBefore(e,t.parentNode)}),nn.remove(u)),nn.remove(t),Je(e.dom,n)&&nn.remove(n)}(e,t.dom,n.dom)})},rn=function(e){ve(e,"dt")&&Ue(e,"dd")},on=function(e,n){if(je(e))return{container:e,offset:n};var t=he.getNode(e,n);return je(t)?{container:t,offset:n>=e.childNodes.length?t.data.length:0}:t.previousSibling&&je(t.previousSibling)?{container:t.previousSibling,offset:t.previousSibling.data.length}:t.nextSibling&&je(t.nextSibling)?{container:t.nextSibling,offset:0}:{container:e,offset:n}},un=function(e){var n=e.cloneRange(),t=on(e.startContainer,e.startOffset);n.setStart(t.container,t.offset);var r=on(e.endContainer,e.endOffset);return n.setEnd(r.container,r.offset),n},an=tinymce.util.Tools.resolve("tinymce.dom.DomQuery"),sn=function(e,n){var t=n||e.selection.getStart(!0);return e.dom.getParent(t,"OL,UL,DL",dn(e,t))},cn=function(e){var n,t,r,o=sn(e),i=e.selection.getSelectedBlocks();return r=i,(t=o)&&1===r.length&&r[0]===t?(n=o,Fe.grep(n.querySelectorAll("ol,ul,dl"),function(e){return qe(e)})):Fe.grep(i,function(e){return qe(e)&&o!==e})},fn=function(e){var n,t,r,o=e.selection.getSelectedBlocks();return Fe.grep((n=e,t=o,r=Fe.map(t,function(e){return n.dom.getParent(e,"li,dd,dt",dn(n,e))||e}),an.unique(r)),function(e){return We(e)})},dn=function(e,n){var t=e.dom.getParents(n,"TD,TH");return 0<t.length?t[0]:e.getBody()},ln=function(e,n){var t=e.dom.getParents(n,"ol,ul",dn(e,n));return R(t)},mn=function(e){var n,t,r,o=(t=ln(n=e,n.selection.getStart()),r=w(n.selection.getSelectedBlocks(),Ke),t.toArray().concat(r));return pn(e,o)},pn=function(e,n){var t=D(n,function(n){return ln(e,n).getOr(n)});return an.unique(t)},gn=function(e,n,t){return e.isSome()&&n.isSome()?v.some(t(e.getOrDie(),n.getOrDie())):v.none()},vn=function(e,n,t){return e.fire("ListMutation",{action:n,element:t})},hn=function(e,n,t){if(!S(t))throw console.error("Invalid call to CSS.set. Property ",n,":: Value ",t,":: Element ",e),new Error("CSS value must be a string: "+t);var r;(r=e).style!==undefined&&O(r.style.getPropertyValue)&&e.style.setProperty(n,t)},yn=function(e,n){Be(e.item,n.list)},Sn=function(e,n,t){for(var r,o,i,u=[],a=0;a<t;a++)u.push((r=e,o=n.listType,i={list:le.fromTag(o,r),item:le.fromTag("li",r)},Be(i.list,i.item),i));return u},bn=function(e,n){for(var t,r,o,i=0;i<e.length-1;i++)t="list-style-type",r="none",o=e[i].item.dom,hn(o,t,r);R(e).each(function(e){Te(e.list,n.listAttributes),Te(e.item,n.itemAttributes),Ie(e.item,n.content)})},Cn=function(e,n,t){var r=n.slice(0,t.depth);return R(r).each(function(n){var r,o,i,u,a,s,c,f;s=(r=e,o=t.itemAttributes,i=t.content,u=le.fromTag("li",r),Te(u,o),Ie(u,i),u),Be((a=n).list,s),a.item=s,f=t,Ne((c=n).list)!==f.listType&&(c.list=Ue(c.list,f.listType)),Te(c.list,f.listAttributes)}),r},On=function(e,n,t){var r,o=Sn(e,t,t.depth-n.length);return function(e){for(var n=1;n<e.length;n++)yn(e[n-1],e[n])}(o),bn(o,t),r=o,gn(R(n),I(r),yn),n.concat(o)},Nn=function(e){return ve(e,"OL,UL")},Ln=function(e){return Ae(e).map(Nn).getOr(!1)},Tn=function(e){return 0<e.depth},Dn=function(e){return e.isSelected},kn=function(e){var n=we(e),t=Ee(e).map(Nn).getOr(!1)?n.slice(0,-1):n;return D(t,Me)},wn=function(e){return k(e,function(n,t){var r,o,i,u,a;i=(r=e)[o=t].depth,u=function(e){return e.depth===i&&!e.dirty},a=function(e){return e.depth<i},A(B(r.slice(0,o)),u,a).orThunk(function(){return A(r.slice(o+1),u,a)}).fold(function(){var e;n.dirty&&((e=n).listAttributes=Oe(e.listAttributes,function(e,n){return"start"!==n}))},function(e){return r=e,(t=n).listType=r.listType,void(t.listAttributes=M({},r.listAttributes));var t,r})}),e},xn=function(e,n,t,r){return Ae(r).filter(Nn).fold(function(){n.each(function(e){me(e.start,r)&&t.set(!0)});var o,i,u,a=(o=r,i=e,u=t.get(),ke(o).filter(Le).map(function(e){return{depth:i,dirty:!1,isSelected:u,content:kn(o),itemAttributes:De(o),listAttributes:De(e),listType:Ne(e)}}));n.each(function(e){me(e.end,r)&&t.set(!1)});var s=Ee(r).filter(Nn).map(function(r){return An(e,n,t,r)}).getOr([]);return a.toArray().concat(s)},function(r){return An(e,n,t,r)})},An=function(e,n,t,r){return P(we(r),function(r){return(Nn(r)?An:xn)(e+1,n,t,r)})},En=function(e,n){var t,r=(t=!1,{get:function(){return t},set:function(e){t=e}});return D(e,function(e){return{sourceList:e,entries:An(0,n,r,e)}})},Pn=function(e,n){var t=wn(n);return D(t,function(n){var t,r,o,i=(t=n.content,o=(r||document).createDocumentFragment(),k(t,function(e){o.appendChild(e.dom)}),le.fromDom(o));return le.fromDom(en(e,i.dom))})},Bn=function(e,n){var t,r,o=wn(n);return t=e.contentDocument,r=x(o,function(e,n){return(n.depth>e.length?On:Cn)(t,e,n)},[]),I(r).map(function(e){return e.list}).toArray()},In=function(e,n,t){var r,o=En(n,(r=D(fn(e),le.fromDom),gn(E(r,f(Ln)),E(B(r),f(Ln)),function(e,n){return{start:e,end:n}})));k(o,function(n){var r,o;r=n.entries,o=t,k(w(r,Dn),function(e){return function(e,n){switch(o){case"Indent":n.depth++;break;case"Outdent":n.depth--;break;case"Flatten":n.depth=0}n.dirty=!0}(0,e),0});var i,u,a,s=(i=e,u=n.entries,P(function(e,n){if(0===e.length)return[];for(var t=n(e[0]),r=[],o=[],i=0,u=e.length;i<u;i++){var a=e[i],s=n(a);s!==t&&(r.push(o),o=[]),t=s,o.push(a)}return 0!==o.length&&r.push(o),r}(u,Tn),function(e){return(I(e).map(Tn).getOr(!1)?Bn:Pn)(i,e)}));k(s,function(n){vn(e,"Indent"===t?"IndentList":"OutdentList",n.dom)}),a=n.sourceList,k(s,function(e){Pe(a,e)}),Re(n.sourceList)})},Rn=function(e,n){var t,r,o=D(mn(e),le.fromDom),i=D(w(fn(e),Qe),le.fromDom),u=!1;return(o.length||i.length)&&(t=e.selection.getBookmark(),In(e,o,n),r=e,k(i,"Indent"===n?rn:function(e){return tn(r,e),0}),e.selection.moveToBookmark(t),e.selection.setRng(un(e.selection.getRng())),e.nodeChanged(),u=!0),u},Mn=function(e){return Rn(e,"Indent")},Un=function(e){return Rn(e,"Outdent")},_n=function(e){return Rn(e,"Flatten")},Fn=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager"),Hn=_e.DOM,$n=function(e){var n={},t=function(t){var r,o=e[t?"startContainer":"endContainer"],i=e[t?"startOffset":"endOffset"];1===o.nodeType&&(r=Hn.create("span",{"data-mce-type":"bookmark"}),o.hasChildNodes()?(i=Math.min(i,o.childNodes.length-1),t?o.insertBefore(r,o.childNodes[i]):Hn.insertAfter(r,o.childNodes[i])):o.appendChild(r),o=r,i=0),n[t?"startContainer":"endContainer"]=o,n[t?"startOffset":"endOffset"]=i};return t(!0),e.collapsed||t(),n},jn=function(e){function n(n){var t,r=t=e[n?"startContainer":"endContainer"],o=e[n?"startOffset":"endOffset"];r&&(1===r.nodeType&&(o=function(e){for(var n=e.parentNode.firstChild,t=0;n;){if(n===e)return t;1===n.nodeType&&"bookmark"===n.getAttribute("data-mce-type")||t++,n=n.nextSibling}return-1}(r),r=r.parentNode,Hn.remove(t),!r.hasChildNodes()&&Hn.isBlock(r)&&r.appendChild(Hn.create("br"))),e[n?"startContainer":"endContainer"]=r,e[n?"startOffset":"endOffset"]=o)}n(!0),n();var t=Hn.createRng();return t.setStart(e.startContainer,e.startOffset),e.endContainer&&t.setEnd(e.endContainer,e.endOffset),un(t)},qn=function(e){switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},Kn=function(e){return/\btox\-/.test(e.className)},Vn=function(e,n,t){var r=function(e){var r=A(e.parents,qe,Xe).filter(function(e){return e.nodeName===n&&!Kn(e)}).isSome();t(r)},o=e.dom.getParents(e.selection.getNode());return r({parents:o}),e.on("NodeChange",r),function(){return e.off("NodeChange",r)}},Wn=function(e,n){Fe.each(n,function(n,t){e.setAttribute(t,n)})},Qn=function(e,n,t){var r,o,i,u,a,s,c;r=e,o=n,u=(i=t)["list-style-type"]?i["list-style-type"]:null,r.setStyle(o,"list-style-type",u),a=e,Wn(s=n,(c=t)["list-attributes"]),Fe.each(a.select("li",s),function(e){Wn(e,c["list-item-attributes"])})},Xn=function(e,n,t,r){var o=n[t?"startContainer":"endContainer"],i=n[t?"startOffset":"endOffset"];for(1===o.nodeType&&(o=o.childNodes[Math.min(i,o.childNodes.length-1)]||o),!t&&ze(o.nextSibling)&&(o=o.nextSibling);o.parentNode!==r;){if(Ye(e,o))return o;if(/^(TD|TH)$/.test(o.parentNode.nodeName))return o;o=o.parentNode}return o},zn=function(e,n,t){void 0===t&&(t={});var r,o=e.selection.getRng(),i="LI",u=dn(e,e.selection.getStart(!0)),a=e.dom;"false"!==a.getContentEditable(e.selection.getNode())&&("DL"===(n=n.toUpperCase())&&(i="DT"),r=$n(o),Fe.each(function(e,n,t){for(var r,o=[],i=e.dom,u=Xn(e,n,!0,t),a=Xn(e,n,!1,t),s=[],c=u;c&&(s.push(c),c!==a);c=c.nextSibling);return Fe.each(s,function(n){if(Ye(e,n))return o.push(n),void(r=null);if(i.isBlock(n)||ze(n))return ze(n)&&i.remove(n),void(r=null);var u=n.nextSibling;Fn.isBookmarkNode(n)&&(Ye(e,u)||!u&&n.parentNode===t)?r=null:(r||(r=i.create("p"),n.parentNode.insertBefore(r,n),o.push(r)),r.appendChild(n))}),o}(e,o,u),function(r){var o,u,s,c,f,d,l,m=r.previousSibling;m&&qe(m)&&m.nodeName===n&&(u=m,s=t,a.getStyle(u,"list-style-type")===(c=null===(c=s?s["list-style-type"]:"")?"":c))?(o=m,r=a.rename(r,i),m.appendChild(r)):(o=a.create(n),r.parentNode.insertBefore(o,r),o.appendChild(r),r=a.rename(r,i)),f=a,d=r,l=["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"],Fe.each(l,function(e){var n;return f.setStyle(d,((n={})[e]="",n))}),Qn(a,o,t),Gn(e.dom,o)}),e.selection.setRng(jn(r)))},Yn=function(e,n,t){return s=t,(a=n)&&s&&qe(a)&&a.nodeName===s.nodeName&&(i=n,u=t,(o=e).getStyle(i,"list-style-type",!0)===o.getStyle(u,"list-style-type",!0))&&(r=t,n.className===r.className);var r,o,i,u,a,s},Gn=function(e,n){var t,r=n.nextSibling;if(Yn(e,n,r)){for(;t=r.firstChild;)n.appendChild(t);e.remove(r)}if(r=n.previousSibling,Yn(e,n,r)){for(;t=r.lastChild;)n.insertBefore(t,n.firstChild);e.remove(r)}},Jn=function(e,n,t,r,o){var i;n.nodeName!==r||Zn(o)?(i=$n(e.selection.getRng(!0)),Fe.each([n].concat(t),function(n){var t,i,u,a,s;t=e,u=r,a=o,(i=n).nodeName!==u?(s=t.dom.rename(i,u),Qn(t.dom,s,a),vn(t,qn(u),s)):(Qn(t.dom,i,a),vn(t,qn(u),i))}),e.selection.setRng(jn(i))):_n(e)},Zn=function(e){return"list-style-type"in e},et=function(e,n,t){var r,o,i,u,a,s,c=sn(e),f=cn(e);t=t||{},c&&0<f.length?Jn(e,c,f,n,t):(i=n,u=t,(o=c)!==(r=e).getBody()&&(o?o.nodeName!==i||Zn(u)||Kn(o)?(a=$n(r.selection.getRng(!0)),Qn(r.dom,o,u),s=r.dom.rename(o,i),Gn(r.dom,s),r.selection.setRng(jn(a)),vn(r,qn(i),s)):_n(r):(zn(r,i,u),vn(r,qn(i),o))))},nt=_e.DOM,tt=function(e,n){Fe.each(Fe.grep(e.select("ol,ul",n)),function(n){var t,r,o,i;t=e,"LI"===(i=(r=n).parentNode).nodeName&&i.firstChild===r&&((o=i.previousSibling)&&"LI"===o.nodeName?(o.appendChild(r),Je(t,i)&&nt.remove(i)):nt.setStyle(i,"listStyleType","none")),qe(i)&&(o=i.previousSibling)&&"LI"===o.nodeName&&o.appendChild(r)})},rt=function(e,n,t,r){var o=n.startContainer,i=n.startOffset;if(je(o)&&(t?i<o.data.length:0<i))return o;var u=e.schema.getNonEmptyElements();1===o.nodeType&&(o=he.getNode(o,i));var a,s,c=new ye(o,r);for(t&&(a=e.dom,ze(s=o)&&a.isBlock(s.nextSibling)&&!ze(s.previousSibling)&&c.next());o=c[t?"next":"prev2"]();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(u[o.nodeName])return o;if(je(o)&&0<o.data.length)return o}},ot=function(e,n){var t=n.childNodes;return 1===t.length&&!qe(t[0])&&e.isBlock(t[0])},it=function(e,n,t){var r,o,i,u=ot(e,t)?t.firstChild:t;if(ot(o=e,i=n)&&o.remove(i.firstChild,!0),!Je(e,n,!0))for(;r=n.firstChild;)u.appendChild(r)},ut=function(e,n,t){var r,o,i,u=n.parentNode;Ze(e,n)&&Ze(e,t)&&(qe(t.lastChild)&&(r=t.lastChild),u===t.lastChild&&ze(u.previousSibling)&&e.remove(u.previousSibling),(o=t.lastChild)&&ze(o)&&n.hasChildNodes()&&e.remove(o),Je(e,t,!0)&&e.$(t).empty(),it(e,n,t),r&&t.appendChild(r),i=ge(le.fromDom(t),le.fromDom(n))?e.getParents(n,qe,t):[],e.remove(n),k(i,function(n){Je(e,n)&&n!==e.getRoot()&&e.remove(n)}))},at=function(e,n,t,r){var o,i,u,a,s=e.dom;s.isEmpty(r)?(u=t,a=r,(i=e).dom.$(a).empty(),ut(i.dom,u,a),i.selection.setCursorLocation(a)):(o=$n(n),ut(s,t,r),e.selection.setRng(jn(o)))},st=function(e,n){var t=e.dom,r=e.selection,o=r.getStart(),i=dn(e,o),u=t.getParent(r.getStart(),"LI",i);if(u){var a=u.parentNode;if(a===e.getBody()&&Je(t,a))return!0;var s=un(r.getRng()),c=t.getParent(rt(e,s,n,i),"LI",i);if(c&&c!==u)return e.undoManager.transact(function(){var t;n?at(e,s,c,u):(t=u).parentNode.firstChild===t?Un(e):function(e,n,t,r){var o=$n(s);ut(e.dom,t,r);var i=jn(o);e.selection.setRng(i)}(e,0,u,c)}),!0;if(!c&&!n&&0===s.startOffset&&0===s.endOffset)return e.undoManager.transact(function(){_n(e)}),!0}return!1},ct=function(e,n){var t=e.dom,r=e.selection.getStart(),o=dn(e,r),i=t.getParent(r,t.isBlock,o);if(i&&t.isEmpty(i)){var u=un(e.selection.getRng()),a=t.getParent(rt(e,u,n,o),"LI",o);if(a)return e.undoManager.transact(function(){var r,u,s,c;u=i,s=o,c=(r=t).getParent(u.parentNode,r.isBlock,s),r.remove(u),c&&r.isEmpty(c)&&r.remove(c),Gn(t,a.parentNode),e.selection.select(a,!0),e.selection.collapse(n)}),!0}return!1},ft=function(e,n){return e.selection.isCollapsed()?st(i=e,u=n)||ct(i,u):(r=(t=e).selection.getStart(),o=dn(t,r),!!(t.dom.getParent(r,"LI,DT,DD",o)||0<fn(t).length)&&(t.undoManager.transact(function(){t.execCommand("Delete"),tt(t.dom,t.getBody())}),!0));var t,r,o,i,u},dt=function(e){var n=e.dom,t=sn(e);Ve(t)&&e.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:n.getAttrib(t,"start")||"1"},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:function(t){var r=t.getData();e.undoManager.transact(function(){n.setAttrib(sn(e),"start","1"===r.start?"":r.start)}),t.close()}})},lt=function(e,n){return function(){var t=e.dom.getParent(e.selection.getStart(),"UL,OL,DL");return t&&t.nodeName===n}},mt=function(e){var n,t;e.getParam("lists_indent_on_tab",!0)&&(n=e).on("keydown",function(e){e.keyCode!==Se.TAB||Se.metaKeyPressed(e)||n.undoManager.transact(function(){(e.shiftKey?Un:Mn)(n)&&e.preventDefault()})}),(t=e).on("keydown",function(e){e.keyCode===Se.BACKSPACE?ft(t,!1)&&e.preventDefault():e.keyCode===Se.DELETE&&ft(t,!0)&&e.preventDefault()})};a.add("lists",function(e){var n,t,r,o,i,u;return!1===e.hasPlugin("rtc",!0)&&(mt(e),(n=e).on("BeforeExecCommand",function(e){var t=e.command.toLowerCase();"indent"===t?Mn(n):"outdent"===t&&Un(n)}),n.addCommand("InsertUnorderedList",function(e,t){et(n,"UL",t)}),n.addCommand("InsertOrderedList",function(e,t){et(n,"OL",t)}),n.addCommand("InsertDefinitionList",function(e,t){et(n,"DL",t)}),n.addCommand("RemoveList",function(){_n(n)}),n.addCommand("mceListProps",function(){dt(n)}),n.addQueryStateHandler("InsertUnorderedList",lt(n,"UL")),n.addQueryStateHandler("InsertOrderedList",lt(n,"OL")),n.addQueryStateHandler("InsertDefinitionList",lt(n,"DL"))),r=function(e){return function(){return t.execCommand(e)}},(t=e).hasPlugin("advlist")||(t.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:r("InsertOrderedList"),onSetup:function(e){return Vn(t,"OL",e.setActive)}}),t.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:r("InsertUnorderedList"),onSetup:function(e){return Vn(t,"UL",e.setActive)}})),i={text:"List properties...",icon:"ordered-list",onAction:function(){return dt(o)},onSetup:function(e){return Vn(o,"OL",function(n){return e.setDisabled(!n)})}},(o=e).ui.registry.addMenuItem("listprops",i),o.ui.registry.addContextMenu("lists",{update:function(e){var n=sn(o,e);return Ve(n)?["listprops"]:[]}}),u=e,{backspaceDelete:function(e){ft(u,e)}}})}();